# CLAUDE.md - Nim MYCIN Expert System

## Project Overview
This is an implementation of the MYCIN expert system in Nim, recreating the famous 1970s Stanford medical expert system for diagnosing bacterial infections. The system uses rule-based reasoning with confidence factors to identify bacterial organisms based on patient, culture, and organism characteristics.

## Project Structure
- `src/mycin.nim` - Core expert system implementation with confidence factors, rules engine, and backward chaining
- `src/mycin_web.nim` - Web interface using Karax framework
- `data/mycin.json` - Default knowledge base with diagnostic rules
- `data/mycin-from-claude.json` - Knowledge base generated by Claude
- `data/mycin-from-gemini.json` - Knowledge base generated by Gemini
- `tests/test_mycin.nim` - Test suite for all knowledge bases
- `mycin.html` - HTML wrapper for web version

## Key Commands
```bash
# Run tests for all knowledge bases
nimble test

# Build the project
nimble build

# Compile and run CLI version
nim compile --run src/mycin.nim

# Run with custom knowledge base
./src/mycin mycin-from-claude
./src/mycin mycin-from-gemini

# Run with test input (avoids EOF error in non-interactive environments)
echo -e "John Doe\n42\nmale\nblood\n3\nunknown\nunknown\nunknown" | ./src/mycin

# Compile web version to JavaScript
nim js src/mycin_web.nim
```

## Development Guidelines
- The system uses backward chaining reasoning starting from goals
- Confidence factors range from -1.0 (definitely false) to 1.0 (definitely true)
- Rules have premises (conditions) and conclusions with confidence factors
- Three main contexts: patient, culture, organism
- Parameters are strongly typed (String, Integer, Float, Boolean)
- User can type "?" during questions to see valid choices
- Type "unknown" to skip questions

## Testing
- Test by running the CLI and answering diagnostic questions
- Verify rule firing by checking confidence factor calculations
- Test web interface by opening mycin.html in browser

## Knowledge Base Structure
The JSON file contains:
- `contexts` - Define problem domains and goals
- `parameters` - Typed variables with validation rules
- `rules` - IF-THEN rules with confidence factors

## Adding New Rules
Rules follow the format:
```json
{
  "num": 999,
  "premises": [["param", "context", "==", "value"]],
  "conclusions": [["param", "context", "==", "value"]],
  "cf": 0.8
}
```

## Style
Prioritize simple, concise, pure functions. Think ultrahard about whether the solution is too complicated before getting back to me. Please follow my exact instructions and give me the minimal code, no fluff or anything extraneous
